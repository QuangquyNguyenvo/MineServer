# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘         âœ¦ TOáº  Äá»˜ MINEPOINT SYSTEM âœ¦                       â•‘
# â•‘   Gá»­i tá»a Ä‘á»™ lÃªn Discord qua Webhook (SkHttp)             â•‘
# â•‘   KÃªnh: ğŸ§­â”ƒğŒğ¢ğ§ğğ©ğ¨ğ¢ğ§ğ­                                     â•‘
# â•‘   DÃ¹ng SkHttp HTTP Request Builder (raw JSON POST)        â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

on load:
    set {toado::webhook} to "https://discord.com/api/webhooks/1470974798115901680/4gmg-np0yFvdrrCrZShs-1OtllaeQGSzevTRZHEMPc9CUjBMnV-NpReexOKUzvNAdhbh"
    send "&d[MinePoint] &fHe thong toa do Discord da san sang!" to console

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# HÃ€M ESCAPE JSON
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function escapeJson(input: text) :: text:
    set {_out} to {_input}
    replace all "\" with "\\" in {_out}
    replace all """" with "\""" in {_out}
    return {_out}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# HÃ€M Gá»¬I WEBHOOK QUA HTTP REQUEST BUILDER
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function sendMinepoint(pname: text, puuid: text, locname: text, cx: number, cy: number, cz: number, dim: text):
    # MÃ u theo dimension
    if {_dim} is "nether":
        set {_color} to 16733525
        set {_dimname} to "Nether"
    else if {_dim} is "end":
        set {_color} to 11141290
        set {_dimname} to "The End"
    else:
        set {_color} to 5763719
        set {_dimname} to "Overworld"

    # Escape text
    set {_safe} to escapeJson({_locname})
    set {_safep} to escapeJson({_pname})

    # URLs
    set {_head} to "https://mc-heads.net/avatar/%{_puuid}%/64"
    set {_body_img} to "https://mc-heads.net/body/%{_puuid}%/128"

    # Build JSON payload
    set {_json} to join "{""username"":""AstolfoCuteo UwU""," and """avatar_url"":""https://i.imgur.com/FdYBnIy.png""," and """embeds"":[{" and """title"":""\u2550\u2550\u2550\u2550\u2550[ \ud83d\udccd %{_safe}% \ud83d\udccd ]\u2550\u2550\u2550\u2550\u2550""," and """color"":%{_color}%," and """fields"":[" and "{""name"":""\u25b8 Toa do"",""value"":""```fix\n  X: %{_cx}%  |  Y: %{_cy}%  |  Z: %{_cz}%\n```"",""inline"":false}," and "{""name"":""\u25b8 Nguoi tao"",""value"":""%{_safep}%"",""inline"":true}," and "{""name"":""\u25b8 The gioi"",""value"":""%{_dimname}%"",""inline"":true}" and "]," and """footer"":{""text"":""\u2726 Raumania SMP \u2726"",""icon_url"":""%{_head}%""}," and """thumbnail"":{""url"":""%{_body_img}%""}" and "}]}"

    # Gá»­i qua SkHttp HTTP Request Builder
    http request builder stored in {_req}:
        url: {toado::webhook}
        method: "POST"
        body: {_json}
        headers:
            Content-Type: application/json

    send async request using {_req}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Lá»†NH /toado <tÃªn Ä‘á»‹a Ä‘iá»ƒm>
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
command /toado [<text>]:
    aliases: /td, /waypoint, /minepoint
    description: ÄÃ¡nh dáº¥u tá»a Ä‘á»™ vÃ  gá»­i lÃªn Discord
    trigger:
        if arg-1 is not set:
            send ""
            send "&8&m                                                  "
            send ""
            send "  &d&lâœ¦ MINEPOINT &8- &7ÄÃ¡nh dáº¥u tá»a Ä‘á»™"
            send ""
            send "&8&m                                                  "
            send ""
            send "  &7Sá»­ dá»¥ng: &b/toado <tÃªn Ä‘á»‹a Ä‘iá»ƒm>"
            send ""
            send "  &7VÃ­ dá»¥:"
            send "    &8â€¢ &b/toado &fNhÃ  cá»§a mÃ¬nh"
            send "    &8â€¢ &b/toado &fSpawner Skeleton"
            send "    &8â€¢ &b/toado &fEnd Portal"
            send ""
            send "  &7Tá»a Ä‘á»™ sáº½ Ä‘Æ°á»£c gá»­i lÃªn &eğŸ§­â”ƒğŒğ¢ğ§ğğ©ğ¨ğ¢ğ§ğ­ &7trÃªn Discord!"
            send "  &7DÃ¹ng &b/toadolist &7Ä‘á»ƒ xem danh sÃ¡ch."
            send ""
            send "&8&m                                                  "
            send ""
            stop

        # Láº¥y thÃ´ng tin
        set {_name} to arg-1
        set {_x} to floor(x-coordinate of player)
        set {_y} to floor(y-coordinate of player)
        set {_z} to floor(z-coordinate of player)
        set {_world} to "%world of player%"

        if {_world} contains "nether":
            set {_dim} to "nether"
        else if {_world} contains "end":
            set {_dim} to "end"
        else:
            set {_dim} to "overworld"

        # LÆ°u tá»a Ä‘á»™
        set {toado::saved::%uuid of player%::%{_name}%} to "&a%{_x}% &7/ &e%{_y}% &7/ &b%{_z}% &8(%{_dim}%)"
        set {toado::all::%{_name}%} to "&a%{_x}%&7, &e%{_y}%&7, &b%{_z}% &8- &f%name of player% &8(%{_dim}%)"

        # ThÃ´ng bÃ¡o trong game
        send ""
        send "&8&m                                                  "
        send ""
        send "  &d&lâœ¦ MINEPOINT &8â”‚ &fÄÃ£ Ä‘Ã¡nh dáº¥u &e%{_name}%"
        send "  &7Tá»a Ä‘á»™: &a%{_x}% &7/ &e%{_y}% &7/ &b%{_z}%"
        send ""
        send "&8&m                                                  "
        send ""
        play sound "entity.experience_orb.pickup" with volume 1 and pitch 1.5 to player

        broadcast ""
        broadcast "&8&m                                                  "
        broadcast ""
        broadcast "  &dâœ¦ &f%player% &7Ä‘Ã¡nh dáº¥u &e%{_name}%"
        broadcast "  &8[&a%{_x}%&7, &e%{_y}%&7, &b%{_z}%&8]"
        broadcast ""
        broadcast "&8&m                                                  "
        broadcast ""

        # Gá»­i webhook qua HTTP POST
        sendMinepoint(name of player, "%uuid of player%", {_name}, {_x}, {_y}, {_z}, {_dim})

        wait 1 second
        send "  &dâœ¦ &aÄÃ£ gá»­i lÃªn Discord! âœ¦" to player

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# /toadolist - Xem danh sÃ¡ch
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
command /toadolist [<text>]:
    aliases: /tdlist, /waypoints
    description: Xem danh sÃ¡ch tá»a Ä‘á»™
    trigger:
        if arg-1 is "all":
            send ""
            send "&8&m                                                  "
            send ""
            send "  &d&lâœ¦ MINEPOINTS &8- &7Táº¥t cáº£ tá»a Ä‘á»™"
            send ""
            send "&8&m                                                  "
            send ""
            if {toado::all::*} is not set:
                send "  &7ChÆ°a cÃ³ tá»a Ä‘á»™ nÃ o."
            else:
                loop {toado::all::*}:
                    send "  &8â€¢ &e%loop-index% &8â”‚ &f%loop-value%"
            send ""
            send "&8&m                                                  "
            send ""
            stop

        send ""
        send "&8&m                                                  "
        send ""
        send "  &d&lâœ¦ MINEPOINTS &8- &7Tá»a Ä‘á»™ cá»§a báº¡n"
        send ""
        send "&8&m                                                  "
        send ""
        if {toado::saved::%uuid of player%::*} is not set:
            send "  &7Báº¡n chÆ°a cÃ³ tá»a Ä‘á»™. DÃ¹ng &b/toado <tÃªn>&7!"
        else:
            loop {toado::saved::%uuid of player%::*}:
                send "  &8â€¢ &e%loop-index% &8â”‚ &f%loop-value%"
        send ""
        send "  &7DÃ¹ng &b/toadolist all &7Ä‘á»ƒ xem táº¥t cáº£."
        send ""
        send "&8&m                                                  "
        send ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# /toadodel - XÃ³a tá»a Ä‘á»™
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
command /toadodel [<text>]:
    aliases: /tddel
    description: XÃ³a tá»a Ä‘á»™
    trigger:
        if arg-1 is not set:
            send ""
            send "&8&m                                                  "
            send ""
            send "  &7Sá»­ dá»¥ng: &c/toadodel <tÃªn>"
            send ""
            send "&8&m                                                  "
            send ""
            stop
        if {toado::saved::%uuid of player%::%arg-1%} is set:
            delete {toado::saved::%uuid of player%::%arg-1%}
            send ""
            send "&8&m                                                  "
            send ""
            send "  &d[MinePoint] &aÄÃ£ xÃ³a &e%arg-1%&a!"
            send ""
            send "&8&m                                                  "
            send ""
        else:
            send ""
            send "&8&m                                                  "
            send ""
            send "  &c[MinePoint] KhÃ´ng tÃ¬m tháº¥y &e%arg-1%&c!"
            send ""
            send "&8&m                                                  "
            send ""
